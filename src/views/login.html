<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Cannabi Doctor</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/login.css">
    <link rel="stylesheet" href="../css/fonst/poppins.css">
    <link rel="icon" href="/src/img/logo-canabis (1).webp" type="image/x-icon">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>

<body>
    <header class="login-header">
        <div class="login-brand">
            <img src="../../src/img/logo-canabis (1).webp" alt="logo" height="60px" width="60px" loading="lazy">
            <div class="brand-text">
                <h1>Cannabi Doctor</h1>
                <h4>alivio con responsabilidad</h4>
            </div>
        </div>
        <div class="back-button">
            <a href="/index.html">
                <i class="fas fa-arrow-left"></i>
                <span>Ir atrás</span>
            </a>
        </div>
    </header>

    <main>
        <div class="login-card">
            <!-- User Icon -->
            <div class="user-icon">
                <i class="fas fa-user"></i>
            </div>

            <!-- Title -->
            <h1 class="login-title">Iniciar Sesión</h1>
            <p class="login-subtitle">Accede a tu cuenta de paciente</p>

            <!-- Login Form -->
            <form class="login-form">
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" name="email" placeholder="tu@email.com" required>
                </div>

                <div class="form-group">
                    <label for="password">Contraseña</label>
                    <div class="password-input">
                        <input type="password" id="password" name="password" required>
                        <button type="button" class="password-toggle" onclick="togglePassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Options -->
                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" name="accept-terms" id="accept-terms" required>
                        <span class="checkmark"></span>
                        Acepto los <a href="#" id="open-terms">Términos y Condiciones</a>
                    </label>
                    <a href="#" class="forgot-password">¿Olvidaste tu contraseña?</a>
                </div>

                <!-- Login Button -->
                <button type="submit" class="login-btn">Iniciar Sesión</button>

                <!-- Register Link -->
                <div class="register-link">
                    <p>¿No tienes cuenta? <a href="#" onclick="toggleForms()">Regístrate</a></p>
                </div>

                <!-- Separator -->
                <div class="separator">
                    <span>O continúa con</span>
                </div>

                <!-- Social Login -->
                <div class="social-login">
                    <button type="button" class="social-btn google-btn">
                        <i class="fab fa-google"></i>
                        Google
                    </button>
                    <button type="button" class="social-btn facebook-btn">
                        <i class="fab fa-facebook-f"></i>
                        Facebook
                    </button>
                </div>
            </form>

            <!-- Register Form (Hidden by default) -->
            <form class="register-form" style="display: none;">
                <div class="form-group">
                    <label for="reg-name">Nombre Completo</label>
                    <input type="text" id="reg-name" name="name" placeholder="Tu nombre completo" required>
                </div>

                <div class="form-group">
                    <label for="reg-email">Correo Electrónico</label>
                    <input type="email" id="reg-email" name="email" placeholder="tu@email.com" required>
                </div>

                <div class="form-group">
                    <label for="reg-password">Contraseña</label>
                    <div class="password-input">
                        <input type="password" id="reg-password" name="password" required>
                        <button type="button" class="password-toggle" onclick="toggleRegPassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="reg-confirm-password">Confirmar Contraseña</label>
                    <div class="password-input">
                        <input type="password" id="reg-confirm-password" name="confirm-password" required>
                        <button type="button" class="password-toggle" onclick="toggleRegConfirmPassword()">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>

                <!-- Terms -->
                <div class="form-options">
                    <label class="checkbox-container">
                        <input type="checkbox" name="terms" required>
                        <span class="checkmark"></span>
                        Acepto los <a href="#" class="terms-link" id="open-terms-register">términos y condiciones</a>
                    </label>
                </div>

                <!-- Register Button -->
                <button type="submit" class="login-btn">Crear Cuenta</button>

                <!-- Login Link -->
                <div class="register-link">
                    <p>¿Ya tienes cuenta? <a href="#" onclick="toggleForms()">Inicia sesión</a></p>
                </div>
            </form>
        </div>
    </main>
        <!-- Modal Términos y Condiciones -->
        <div id="terms-modal" class="terms-modal" style="display:none;">
            <div class="terms-modal-content">
                <span class="close-terms" id="close-terms">&times;</span>
                <h1>Términos y Condiciones</h1>
                <p class="last-updated">Última actualización: 2025</p>
                <div class="terms-content">
                    <section class="terms-section">
                        <h2>1. Aceptación de los Términos</h2>
                        <p>Al acceder y utilizar la plataforma Cannabi Doctor, usted acepta estar sujeto a estos términos y condiciones. Si no está de acuerdo con alguna parte de estos términos, no debe utilizar nuestros servicios.</p>
                    </section>
                    <section class="terms-section">
                        <h2>2. Descripción del Servicio</h2>
                        <p>Cannabi Doctor es una plataforma educativa y de consulta médica especializada en el uso terapéutico del cannabis medicinal. Nuestros servicios incluyen:</p>
                        <ul>
                            <li>Información educativa sobre cannabis medicinal</li>
                            <li>Consultas médicas especializadas</li>
                            <li>Recursos informativos sobre tratamientos</li>
                            <li>Plataforma de comunicación médico-paciente</li>
                        </ul>
                    </section>
                    <section class="terms-section">
                        <h2>3. Uso Aceptable</h2>
                        <p>Usted se compromete a utilizar nuestros servicios únicamente para:</p>
                        <ul>
                            <li>Obtener información médica legítima</li>
                            <li>Consultas médicas apropiadas</li>
                            <li>Uso personal y no comercial</li>
                            <li>Cumplir con todas las leyes aplicables</li>
                        </ul>
                    </section>
                    <section class="terms-section">
                        <h2>4. Restricciones de Uso</h2>
                        <p>Está prohibido:</p>
                        <ul>
                            <li>Usar la plataforma para actividades ilegales</li>
                            <li>Compartir información médica confidencial</li>
                            <li>Intentar acceder a cuentas de otros usuarios</li>
                            <li>Transmitir virus o código malicioso</li>
                            <li>Usar la plataforma para fines comerciales no autorizados</li>
                        </ul>
                    </section>
                    <section class="terms-section">
                        <h2>5. Información Médica</h2>
                        <p><strong>Importante:</strong> La información proporcionada en Cannabi Doctor es únicamente con fines educativos y no constituye consejo médico profesional. Siempre consulte con un profesional de la salud calificado antes de comenzar cualquier tratamiento.</p>
                        <p>No garantizamos la precisión, completitud o utilidad de la información médica proporcionada.</p>
                    </section>
                    <section class="terms-section">
                        <h2>6. Privacidad y Confidencialidad</h2>
                        <p>Su privacidad es importante para nosotros. Toda la información médica y personal se maneja de acuerdo con nuestra Política de Privacidad y las leyes de protección de datos aplicables.</p>
                        <p>Los profesionales médicos están obligados a mantener la confidencialidad de la información del paciente según las normas éticas médicas.</p>
                    </section>
                    <section class="terms-section">
                        <h2>7. Cuentas de Usuario</h2>
                        <p>Para acceder a ciertos servicios, debe crear una cuenta. Usted es responsable de:</p>
                        <ul>
                            <li>Mantener la confidencialidad de sus credenciales</li>
                            <li>Todas las actividades que ocurran bajo su cuenta</li>
                            <li>Notificar inmediatamente cualquier uso no autorizado</li>
                            <li>Proporcionar información precisa y actualizada</li>
                        </ul>
                    </section>
                    <section class="terms-section">
                        <h2>8. Limitación de Responsabilidad</h2>
                        <p>Cannabi Doctor no será responsable por:</p>
                        <ul>
                            <li>Daños directos, indirectos o incidentales</li>
                            <li>Pérdida de datos o interrupciones del servicio</li>
                            <li>Consecuencias del uso de la información médica</li>
                            <li>Acciones de terceros o proveedores médicos</li>
                        </ul>
                    </section>
                    <section class="terms-section">
                        <h2>9. Propiedad Intelectual</h2>
                        <p>Todo el contenido de Cannabi Doctor, incluyendo textos, gráficos, logos y software, está protegido por derechos de autor y otras leyes de propiedad intelectual. No se permite la reproducción o distribución sin autorización previa.</p>
                    </section>
                    <section class="terms-section">
                        <h2>10. Modificaciones</h2>
                        <p>Nos reservamos el derecho de modificar estos términos en cualquier momento. Los cambios entrarán en vigor inmediatamente después de su publicación. Su uso continuado de la plataforma constituye aceptación de los términos modificados.</p>
                    </section>
                    <section class="terms-section">
                        <h2>11. Terminación</h2>
                        <p>Podemos suspender o terminar su acceso a nuestros servicios en cualquier momento por violación de estos términos o por cualquier otra razón a nuestra discreción.</p>
                    </section>
                    <section class="terms-section">
                        <h2>12. Ley Aplicable</h2>
                        <p>Estos términos se rigen por las leyes del país donde opera Cannabi Doctor. Cualquier disputa será resuelta en los tribunales competentes de dicha jurisdicción.</p>
                    </section>
                    <section class="terms-section">
                        <h2>13. Contacto</h2>
                        <p>Si tiene preguntas sobre estos términos y condiciones, puede contactarnos a través de:</p>
                        <ul>
                            <li>Email: legal@cannabidoctor.com</li>
                            <li>Teléfono: +1 (555) 123-4567</li>
                            <li>Dirección: [Dirección de la empresa]</li>
                        </ul>
                    </section>
                </div>
            </div>
        </div>

    <script>
        // Modal Términos y Condiciones
        document.getElementById('open-terms').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('terms-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        });
        document.getElementById('open-terms-register').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('terms-modal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        });
        document.getElementById('close-terms').addEventListener('click', function() {
            document.getElementById('terms-modal').style.display = 'none';
            document.body.style.overflow = '';
        });
        function togglePassword() {
            const passwordInput = document.getElementById('password');
            const toggleBtn = document.querySelector('.password-toggle i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
        }

        function toggleRegPassword() {
            const passwordInput = document.getElementById('reg-password');
            const toggleBtn = document.querySelector('#reg-password').nextElementSibling.querySelector('i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
        }

        function toggleRegConfirmPassword() {
            const passwordInput = document.getElementById('reg-confirm-password');
            const toggleBtn = document.querySelector('#reg-confirm-password').nextElementSibling.querySelector('i');

            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.classList.remove('fa-eye');
                toggleBtn.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                toggleBtn.classList.remove('fa-eye-slash');
                toggleBtn.classList.add('fa-eye');
            }
        }

        function toggleForms() {
            const loginForm = document.querySelector('.login-form');
            const registerForm = document.querySelector('.register-form');
            const loginTitle = document.querySelector('.login-title');
            const loginSubtitle = document.querySelector('.login-subtitle');
            const userIcon = document.querySelector('.user-icon i');

            if (loginForm.style.display === 'none') {
                // Mostrar login
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                loginTitle.textContent = 'Iniciar Sesión';
                loginSubtitle.textContent = 'Accede a tu cuenta de paciente';
                userIcon.className = 'fas fa-user';
            } else {
                // Mostrar registro
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                loginTitle.textContent = 'Crear Cuenta';
                loginSubtitle.textContent = 'Regístrate para acceder a Cannabi Doctor';
                userIcon.className = 'fas fa-user-plus';
            }
        }

        // Form submission
        document.querySelector('.login-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            const terms = document.getElementById('accept-terms');
            if (!terms.checked) {
                alert('Debes aceptar los Términos y Condiciones para iniciar sesión.');
                return;
            }
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            try {
                const res = await fetch('http://localhost:3001/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const data = await res.json();
                if (res.ok) {
                    alert('Login exitoso. Bienvenido ' + data.user.name_user);
                    // Guardar usuario en localStorage con id_user y name_user
                    localStorage.setItem('user', JSON.stringify({
                        id_user: data.user.id_user,
                        name_user: data.user.name_user,
                        email: data.user.email
                    }));
                    // Redirigir al usuario (ejemplo: a la página principal)
                    window.location.href = '/Cannabi-Doctor/index.html';
                } else {
                    alert('Error: ' + (data.error || 'No se pudo iniciar sesión.'));
                }
            } catch (err) {
                alert('Error de conexión con el servidor.');
            }
        });

        document.querySelector('.register-form').addEventListener('submit', async function (e) {
            e.preventDefault();
            const name_user = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const terms = document.querySelector('.register-form input[name="terms"]');

            if (!terms.checked) {
                alert('Debes aceptar los términos y condiciones para registrarte.');
                return;
            }
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden.');
                return;
            }

            // Enviar datos al backend (name_user, email y contraseña)
            try {
                const res = await fetch('http://localhost:3001/api/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name_user, email, password })
                });
                const data = await res.json();
                if (res.ok) {
                    alert('Usuario registrado correctamente. Ahora puedes iniciar sesión.');
                    toggleForms();
                } else {
                    alert('Error: ' + (data.error || 'No se pudo registrar el usuario.'));
                }
            } catch (err) {
                alert('Error de conexión con el servidor.');
            }
        });
    </script>
        <footer>
            <div class="container footer-content">
                <p>&copy; 2025 Cannabi Doctor - Todos los derechos reservados</p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </footer>
</body>

</html>

