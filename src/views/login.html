<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/src/css/style.css">
    <link rel="icon" href="/src/img/logo-canabis (1).webp" type="image/x-icon">
    <title>Cannabi Doctor</title>
</head>
<body>
    <header>
        <div class="logo">
            <img src="src/img/logo-canabis (1).webp" alt="logo" height="60px" width="60px" loading="lazy">
            <div class="text">
                <h1>Cannabi Doctor</h1>
                <h4>alivio con responsabilidad</h4>
            </div>
        </div>
        <nav class="links">
            <ul>
                <li><a href="./index .html">Inicio</a></li>
                <li><a href="./src/views/beneficios.html">Beneficios</a></li>
                <li><a href="./src/views/questions.html">Preguntas</a></li>
                <li><a href="#">Contacto</a></li>
            </ul>
        </nav>
        <div class="container-btn-nav">
            <div href="login.html" class="button_slide slide_right">INICIAR SECCION</div>
        </div>
    </header>
    
    <main class="wrap">
      <section class="card">
        <h2>Iniciar Sesión</h2>
        <form id="form-login" class="form" novalidate>
          <input class="input" id="email" type="email" placeholder="Correo electrónico" required>
          <input class="input" id="password" type="password" placeholder="Contraseña" required>
          <button class="btn" type="submit">Entrar</button>
        </form>
    
        <p class="meta"><a class="link" id="forgot" href="#">¿Olvidaste tu contraseña?</a></p>
    
        <div class="divider" style="margin:14px 0">o continúa con</div>
        <button id="btn-google" class="btn btn-outline" type="button">Google</button>
    
        <p class="helper" id="msg"></p>
      </section>
    </main>
    
    <script type="module">
      import {
        auth, signInWithEmailAndPassword, onAuthStateChanged,
        providerGoogle, signInWithPopup, sendPasswordResetEmail
      } from "./firebase.js";
    
      const $ = (id)=>document.getElementById(id);
      const form = $("form-login"); const msg = $("msg");
    
      form.addEventListener("submit", async (e)=>{
        e.preventDefault(); msg.textContent="";
        const email = $("email").value.trim();
        const pass = $("password").value;
        try{
          await signInWithEmailAndPassword(auth, email, pass);
          window.location.href = "app.html";
        }catch(err){ msg.textContent = parseError(err); }
      });
    
      $("btn-google").addEventListener("click", async ()=>{
        msg.textContent="";
        try{ await signInWithPopup(auth, providerGoogle); window.location.href = "app.html"; }
        catch(err){ msg.textContent = parseError(err); }
      });
    
      $("forgot").addEventListener("click", async (e)=>{
        e.preventDefault();
        const email = prompt("Ingresa tu correo para restablecer:");
        if(!email) return;
        try{ await sendPasswordResetEmail(auth, email); alert("Te enviamos un correo para restablecer la contraseña."); }
        catch(err){ alert(parseError(err)); }
      });
    
      onAuthStateChanged(auth, (u)=>{ /* si quieres, redirigir si ya está logueado */ });
    
      function parseError(e){
        const c=e?.code||"";
        if(c.includes("user-not-found")) return "Usuario no encontrado.";
        if(c.includes("wrong-password")) return "Contraseña incorrecta.";
        if(c.includes("too-many-requests")) return "Demasiados intentos. Espera un momento.";
        return "Error: " + (e.message || "intenta de nuevo.");
      }
    </script>
    </body></html>
    