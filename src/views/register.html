<!DOCTYPE html><html lang="es"><head>
    <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Crear Cuenta ‚Äî Cannabi Doctor</title>
    <link rel="stylesheet" href="/src/css/style.css">
    </head><body>
    <header class="header"><h1>üåø Cannabi Doctor</h1><a class="link" href="login.html">Iniciar sesi√≥n</a></header>
    
    <main class="wrap">
      <section class="card">
        <h2>Crear Cuenta</h2>
        <form id="form-register" class="form" novalidate>
          <input class="input" id="name" type="text" placeholder="Nombre completo" autocomplete="name" required>
          <input class="input" id="email" type="email" placeholder="Correo electr√≥nico" autocomplete="email" required>
          <input class="input" id="password" type="password" placeholder="Contrase√±a (min 8 caracteres)" required>
          <input class="input" id="confirm" type="password" placeholder="Confirmar contrase√±a" required>
          <label class="row">
            <input type="checkbox" id="terms" required>
            <span>Acepto los <a class="link" href="terminos.html" target="_blank">t√©rminos y condiciones</a></span>
          </label>
          <button class="btn" type="submit">Crear cuenta</button>
        </form>
    
        <div class="divider" style="margin:14px 0">o contin√∫a con</div>
        <button id="btn-google" class="btn btn-outline" type="button">Google</button>
    
        <p class="meta">¬øYa tienes cuenta? <a class="link" href="login.html">Inicia sesi√≥n</a></p>
        <p class="helper" id="msg"></p>
      </section>
    </main>
    
    <!-- Firebase + l√≥gica -->
    <script type="module">
      import {
        auth, onAuthStateChanged, createUserWithEmailAndPassword,
        providerGoogle, signInWithPopup, updateProfile
      } from "./firebase.js";
      import { createUserProfile } from "./firebase.js";
    
      const $ = (id)=>document.getElementById(id);
      const form = $("form-register"); const msg = $("msg");
    
      form.addEventListener("submit", async (e)=>{
        e.preventDefault(); msg.textContent = "";
        const name = $("name").value.trim();
        const email = $("email").value.trim();
        const pass = $("password").value;
        const confirm = $("confirm").value;
        const terms = $("terms").checked;
    
        if (!terms) return msg.textContent = "Debes aceptar los t√©rminos.";
        if (pass.length < 8) return msg.textContent = "La contrase√±a debe tener al menos 8 caracteres.";
        if (pass !== confirm) return msg.textContent = "Las contrase√±as no coinciden.";
    
        try {
          const cred = await createUserWithEmailAndPassword(auth, email, pass);
          await updateProfile(cred.user, { displayName: name });
          await createUserProfile(cred.user.uid, { email, name });
          window.location.href = "app.html"; // tu panel/home autenticado
        } catch (err) {
          msg.textContent = parseError(err);
        }
      });
    
      $("btn-google").addEventListener("click", async ()=>{
        msg.textContent = "";
        try {
          const { user } = await signInWithPopup(auth, providerGoogle);
          await createUserProfile(user.uid, { email: user.email, name: user.displayName ?? "Usuario" });
          window.location.href = "app.html";
        } catch (err) { msg.textContent = parseError(err); }
      });
    
      onAuthStateChanged(auth, (u)=>{ if(u) {/* opcional redir si ya logueado */} });
    
      function parseError(e){
        const code = e?.code ?? "";
        if(code.includes("email-already-in-use")) return "Ese correo ya est√° registrado.";
        if(code.includes("invalid-email")) return "Correo inv√°lido.";
        if(code.includes("weak-password")) return "Contrase√±a muy d√©bil.";
        return "Error: " + (e.message || "intenta de nuevo.");
      }
    </script>
    </body></html>
    